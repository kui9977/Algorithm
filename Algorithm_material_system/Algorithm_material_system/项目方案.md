# 基于多模态学习的复合金属材料智能分析识别系统设计

## 一、数据预处理

### 1. 颜色（文本）预处理

#### 选择方法：**嵌入编码（Embedding）**

- 颜色作为文本数据，需要通过嵌入将其转换为定长向量。
- 构建颜色词汇表，将颜色转换为索引。
- 使用 `nn.Embedding(num_colors, embed_dim)` 进行嵌入。
- 输出一个定长向量用于后续模型融合。

### 2. 数值属性预处理

#### 处理流程

- 特征标准化：对物理属性如密度、电阻率等进行 Z-score 标准化。
- 处理缺失值：使用"-1"填充缺失数据。
- 异常值处理：通过 Z-score 检测并处理异常值。

## 二、神经网络架构设计

### 1. 颜色分支（文本嵌入）

```plaintext
Input: 颜色文本（索引） → nn.Embedding → nn.Linear → 激活（ReLU）
Output: 颜色向量 (d1)
```

### 2. 数值分支（多层感知器 MLP）

```plaintext
Input: 数值特征 → Linear(20, 64) → ReLU → Dropout
      → Linear(64, 128) → ReLU → Dropout
Output: 数值向量 (d2)
```

### 3. Transformer 模块用于模态融合

- **输入嵌入：** 颜色嵌入向量和数值嵌入向量将作为输入，先进行线性变换调整维度。
- **Transformer 编码器：** 使用 `nn.TransformerEncoder`，通过多头自注意力机制来学习不同模态之间的关系。
- **层数和维度：** 使用 2 层 Transformer 编码器，每层 8 个注意力头，维度为 128。

### 4. 融合层

- 在 Transformer 编码器的输出基础上进行拼接和降维。
- 使用 `nn.Linear` 进行维度映射。
- 使用 Dropout 和 BatchNorm 提高模型泛化能力。

```plaintext
Concat(颜色向量, 数值向量) → Linear(d1+d2, 256) → ReLU → Dropout
                         → Linear(256, 128) → ReLU → Dropout
Output: 融合特征向量
```

### 5. 输出层（分类任务）

- 使用 Softmax 激活函数输出分类概率。
- 对应材料类别分类，损失函数使用 `CrossEntropyLoss()`。

```plaintext
Linear(128, num_classes) → Softmax (训练时用 CrossEntropyLoss)
```

---

## 三、训练方案设计

### 1. 损失函数

- 使用 `nn.CrossEntropyLoss()`，适用于多类别分类任务。
- 如果类别不均衡，可以加入类别权重进行平衡。

### 2. 优化器和调度器

- 使用 Adam 或 AdamW 优化器。
- 学习率调度器：可以选择 `StepLR` 或 `CosineAnnealingLR`。

### 3. 正则化技巧

- 使用 Dropout (p=0.2~0.5) 在全连接层后进行正则化。
- 使用 BatchNorm 增强模型稳定性和训练速度。
- 数据增强：对于不平衡数据集，使用过采样/欠采样技术，或对少量样本进行合成。

### 4. 模型评估指标

| 指标 | 说明 |
|------|------|
| Accuracy | 基本准确率 |
| Top-K Accuracy | Top-3/Top-5命中率（适合多分类） |
| F1-score | 类别不均时更有参考价值 |
| Confusion Matrix | 直观观察错误类别间混淆 |

### 5. 模型保存与早停策略

- 保存最优模型权重（验证集准确率或F1最高）。
- 使用 `early stopping` 策略，若验证集准确率在若干轮内未提高，提前停止训练。

---

## 四、模型训练与推理

### 1. 模型训练流程

- 使用训练集进行模型训练。
- 每个 epoch 后，计算验证集损失与准确率。
- 使用 TensorBoard 或 Matplotlib 可视化训练过程。

### 2. 推理与预测

- 在测试集上进行推理，评估最终的模型性能。

## 五、总结与扩展

### 1. 模型扩展

- 使用**迁移学习**，如预训练的 Transformer 模型，可以加速模型训练并提高性能。

### 2. 数据增强

- 增加合成数据或使用生成对抗网络（GAN）来增强样本。
